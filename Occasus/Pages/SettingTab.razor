@using Humanizer
@using Occasus.Helpers
@using System.Collections

<MudTabPanel Text="@CardTitle">
    <EditForm @bind-IsValid=formIsValid @ref=form id=@formId Model=@Setting.Value OnValidSubmit=OnValidSubmit OnInvalidSubmit=OnInvalidSubmit>
        <DataAnnotationsValidator />

        @foreach (var settingProperty in editableProperties)
        {
            <SettingWrapper POCO=Setting.Value SettingProperty=settingProperty OnSave=@Save />
        }

        @if (validateOptionsResult != null && validateOptionsResult.Failed)
        {
            <MudPaper Class="pa-2 mt-3 d-block">
                @foreach (var message in validateOptionsResult.Failures)
                {
                    <MudText Color=Color.Error>@message</MudText>
                }
            </MudPaper>
        }
        <ValidationSummary />
        <MudToolBar>
            <MudButton ButtonType=ButtonType.Submit FullWidth=true Variant=Variant.Outlined Disabled="!Setting.HasChanged" Color=@(form!.EditContext?.Validate() ?? true ? Color.Secondary : Color.Error)>Save</MudButton>
        </MudToolBar>
    </EditForm>
</MudTabPanel>